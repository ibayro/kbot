name: kbot-cicd

on: push

jobs:
    ci:
        name: ci
        runs-on: ubuntu-latest

        steps:
        - name: Checkout
          uses: actions/checkout@v3

        - name: Run test
          run: make test
        - name: Docker Hub login
          uses: docker/login-action@v2
          with:
            username: ${{ secrets.DOCKERHUB_USERNAME }}
            password: ${{ secrets.DOCKERHUB_TOKEN }}
        - name: build&push
          env:
            APP: "kbot"
            REGISTRY: ${{ secrets.DOCKERHUB_USERNAME }}
          run: make image_windows push_windows

